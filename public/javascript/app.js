// Generated by CozyScript 0.1.1
(function() {
  var app;

  app = angular.module('moedict-web', ['ngResource', '$strap.directives']);

  app.controller('MoeDictCtrl', function($scope, $resource) {
    var MoeDict, MoeTitleDict, last_title_q;
    MoeDict = $resource('/q/web/:query$');
    MoeTitleDict = $resource('/q/title/:query');
    $scope.dict_items = [];
    $scope.dict_content = {};
    last_title_q = ' ';
    window.updater = function(query) {
      var dict_content, dict_items;
      if (query.length >= 1 && query.indexOf(last_title_q) !== 0) {
        last_title_q = query.substring(0, 1);
        dict_items = MoeTitleDict.query({
          query: last_title_q
        }, function() {
          var item, _i, _len, _results;
          $scope.dict_items = [];
          _results = [];
          for (_i = 0, _len = dict_items.length; _i < _len; _i++) {
            item = dict_items[_i];
            _results.push($scope.dict_items.push(item.title));
          }
          return _results;
        });
      }
      return dict_content = MoeDict.query({
        query: query
      }, function() {
        if ((dict_content != null) && (dict_content[0] != null) && (dict_content[0].title != null)) {
          dict_content[0].bopomofo = dict_content[0].bopomofo.replace(/^(\s*)/, '');
          $scope.dict_content = dict_content[0];
          return history.pushState(null, null, "#" + query);
        }
      });
    };
    return $scope.change = function() {
      return updater($scope.dict_q);
    };
  });

  $(document).ready(function() {
    var match;
    if (match = /^#(.*)/.exec(location.hash)) {
      return window.updater(match[1]);
    }
  });

}).call(this);
